<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function ($scope, $timeout) {
  var c = this;

  function loadChartJs(cb) {
    if (window.Chart) {
      cb();
      return;
    }

    var s = document.createElement('script');
    s.src = 'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';
    s.onload = cb;
    document.head.appendChild(s);
  }

  function renderChart() {

    var values = [
      c.data.activeCourses || 0,
      c.data.completedCourses || 0,
      c.data.totalLearners || 0
    ];

    var hasData = values.some(function (v) {
      return v > 0;
    });

    var ctx = document.getElementById('instructorOverviewDonut');
    if (!ctx) return;

    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: hasData
          ? ['Active Courses', 'Completed Courses', 'Total Learners']
          : ['No instructor data'],
        datasets: [{
          data: hasData ? values : [1],
          backgroundColor: hasData
            ? ['#22c55e', '#3b82f6', '#f59e0b']
            : ['#e5e7eb'],
          borderWidth: 0
        }]
      },
      options: {
        cutout: '70%',
        plugins: {
          legend: {
            display: hasData,
            position: 'bottom'
          },
          tooltip: {
            enabled: hasData
          }
        }
      }
    });
  }

  $timeout(function () {
    loadChartJs(renderChart);
  }, 300);
};
]]></client_script>
        <controller_as>c</controller_as>
        <css>

/* OVERVIEW CARD */
.user-overview-card {
  display: grid;
  grid-template-columns: 1.5fr 1fr;
  gap: 28px;
  background: #ffffff;
  border-radius: 22px;
  padding: 28px;
  box-shadow: 0 14px 35px rgba(0,0,0,0.08);
  margin-bottom: 36px;
}

/* BIG STATS */
.big-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
}
.big-stat {
  background: #f8fafc;
  border-radius: 16px;
  padding: 18px;
}
.big-stat .label {
  font-size: 13px;
  color: #64748b;
}
.big-stat .value {
  font-size: 28px;
  font-weight: 800;
  color: #0f172a;
}

/* CHART */
.chart-card {
  background: #ffffff;
  border-radius: 20px;
  padding: 20px;
  text-align: center;
}
#instructorOverviewDonut {
  width: 220px !important;
  height: 220px !important;
  display: block;
  margin: 0 auto;
}

</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>instructor_course_report</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Instructor Course Report</name>
        <option_schema/>
        <public>false</public>
        <roles>x_1862243_training.training instructor</roles>
        <script><![CDATA[(function () {

  data.reports = [];

  /* =========================
     TOP METRICS
     ========================= */
  data.coursesAssigned = 0;
  data.activeCourses = 0;
  data.completedCourses = 0;
  data.totalLearners = 0;

  /* =========================
     CHART DATA
     ========================= */
  data.chart = {
    active: 0,
    completed: 0
  };

var courseGR = new GlideRecord('x_1862243_training_training_course_table');
courseGR.addQuery('instructor', gs.getUserID());
courseGR.query();

while (courseGR.next()) {

  data.coursesAssigned++;

  var isActive = courseGR.getValue('active') == '1'; // âœ… FIXED


    if (isActive) {
      data.activeCourses++;
      data.chart.active++;
    } else {
      data.completedCourses++;
      data.chart.completed++;
    }

    /* === Registered === */
    var regAgg = new GlideAggregate('x_1862243_training_training_registration_table');
    regAgg.addQuery('course', courseGR.sys_id);
    regAgg.addAggregate('COUNT');
    regAgg.query();
    regAgg.next();

    var registered = parseInt(regAgg.getAggregate('COUNT'), 10) || 0;
    data.totalLearners += registered;

    var maxSeats = parseInt(courseGR.maximum_seats, 10) || 0;
    var availableSeats = parseInt(courseGR.available_seats, 10) || 0;

    var filledPercent = maxSeats > 0
      ? Math.round(((maxSeats - availableSeats) / maxSeats) * 100)
      : 0;

    data.reports.push({
      course: courseGR.getDisplayValue('course_name'),
      status: isActive ? 'Active' : 'Completed',
      maxSeats: maxSeats,
      availableSeats: availableSeats,
      registered: registered,
      filled: filledPercent + '%',
      endDate: courseGR.getDisplayValue('course_end_date')
    });
  }

})();
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-11 06:36:34</sys_created_on>
        <sys_id>266934ba83de721084ade7d0deaad331</sys_id>
        <sys_mod_count>18</sys_mod_count>
        <sys_name>Instructor Course Report</sys_name>
        <sys_package display_value="Training Registration and Certification Portal" source="x_1862243_training">cd4f29228352721084ade7d0deaad3c0</sys_package>
        <sys_policy/>
        <sys_scope display_value="Training Registration and Certification Portal">cd4f29228352721084ade7d0deaad3c0</sys_scope>
        <sys_update_name>sp_widget_266934ba83de721084ade7d0deaad331</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-15 09:53:25</sys_updated_on>
        <template><![CDATA[
<!-- ================= INSTRUCTOR OVERVIEW ================= -->
<div class="user-overview-card">

  <!-- LEFT : BIG CARDS -->
  <div class="overview-left">
    <h3>Instructor Overview</h3>

    <div class="big-stats">
      <div class="big-stat">
        <span class="label">Courses Assigned</span>
        <span class="value">{{data.coursesAssigned}}</span>
      </div>

      <div class="big-stat">
        <span class="label">Active Courses</span>
        <span class="value">{{data.activeCourses}}</span>
      </div>

      <div class="big-stat">
        <span class="label">Completed Courses</span>
        <span class="value">{{data.completedCourses}}</span>
      </div>

      <div class="big-stat">
        <span class="label">Total Learners</span>
        <span class="value">{{data.totalLearners}}</span>
      </div>
    </div>
  </div>

  <!-- RIGHT : CHART -->
  <div class="overview-right">
    <div class="chart-card">
      <h4>Course Status</h4>
      <canvas id="instructorOverviewDonut"></canvas>
    </div>
  </div>

</div>
]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>266934ba83de721084ade7d0deaad331</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-15 08:50:43</sys_created_on>
        <sys_id>367ef54c83e23a1084ade7d0deaad305</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-15 08:50:43</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
