<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function ($scope, $location) {

  $scope.goToRegistration = function () {
    var courseId = $scope.data.course.sys_id;
    $location.url('?id=course_registration&course_id=' + courseId);
  };

	$scope.goToWaitlist = function () {
  var courseId = $scope.data.course.sys_id;
  $location.url('?id=course_registration&course_id=' + courseId + '&waitlist=true');
};

};
]]></client_script>
        <controller_as>c</controller_as>
        <css>/* ======================================================
   ROOT
   ====================================================== */
.course-container {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  gap: 32px;
  font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
}

/* ======================================================
   HEADER
   ====================================================== */
.course-header {
  padding-bottom: 14px;
  border-bottom: 1px solid #e5e7eb;
}

.course-title {
  font-size: 28px;
  font-weight: 800;
  color: #0f172a;
}

.course-meta-row {
  margin-top: 8px;
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

.course-code {
  font-size: 12px;
  font-weight: 700;
  padding: 5px 12px;
  border-radius: 999px;
  background: #eef2ff;
  color: #3730a3;
}

/* Status */
.course-status {
  font-size: 12px;
  font-weight: 700;
  padding: 5px 12px;
  border-radius: 999px;
}

.course-status.active {
  background: #dcfce7;
  color: #166534;
}

.course-status.inactive {
  background: #fee2e2;
  color: #991b1b;
}

/* ======================================================
   COURSE OVERVIEW CARD
   ====================================================== */
.course-overview {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 32px;
  background: #ffffff;
  border-radius: 22px;
  padding: 30px;
  box-shadow: 0 16px 40px rgba(0,0,0,0.08);
}

/* ======================================================
   DESCRIPTION
   ====================================================== */
.course-description-block {
  margin-bottom: 26px;
}

.desc-label {
  display: block;
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 0.6px;
  text-transform: uppercase;
  color: #64748b;
  margin-bottom: 8px;
}

.course-description {
  font-size: 15px;
  line-height: 1.8;
  color: #334155;
  background: #f8fafc;
  padding: 18px 20px;
  border-radius: 16px;
}

/* ======================================================
   INFO GRID
   ====================================================== */
.info-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
}

.info-item {
  background: #f9fafb;
  border-radius: 16px;
  padding: 16px 18px;
}

.info-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  color: #64748b;
  display: block;
  margin-bottom: 6px;
}

.info-value {
  font-size: 15px;
  font-weight: 600;
  color: #0f172a;
}

.info-chip {
  display: inline-block;
  background: #ecfeff;
  color: #155e75;
  font-size: 13px;
  font-weight: 700;
  padding: 6px 14px;
  border-radius: 999px;
}

/* ======================================================
   STATS (RIGHT SIDE)
   ====================================================== */
.course-stats {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.stat-card {
  background: linear-gradient(135deg, #0f172a, #1e293b);
  border-radius: 22px;
  padding: 28px;
  text-align: center;
  color: #ffffff;
}

.stat-number {
  font-size: 42px;
  font-weight: 900;
}

.stat-label {
  font-size: 14px;
  font-weight: 600;
  opacity: 0.9;
}

.stat-sub {
  font-size: 13px;
  opacity: 0.75;
}

/* ======================================================
   ACTION BUTTONS
   ====================================================== */
.stat-actions {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.btn-primary {
  background: linear-gradient(135deg, #2563eb, #3b82f6);
  color: #ffffff;
  border: none;
  border-radius: 16px;
  padding: 14px;
  font-size: 15px;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.25s ease;
}

.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 14px 30px rgba(59,130,246,0.45);
}

.btn-primary:disabled {
  background: #c7d2fe;
  cursor: not-allowed;
  box-shadow: none;
  transform: none;
}

.btn-secondary {
  background: linear-gradient(135deg, #facc15, #f59e0b);
  color: #1f2937;
  border: none;
  border-radius: 16px;
  padding: 14px;
  font-size: 15px;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.25s ease;
}

.btn-secondary:hover {
  transform: translateY(-3px);
  box-shadow: 0 14px 30px rgba(245,158,11,0.45);
}

/* ======================================================
   EMPTY STATE
   ====================================================== */
.empty-state {
  background: #f8fafc;
  border-radius: 22px;
  padding: 48px 24px;
  text-align: center;
  font-size: 16px;
  color: #64748b;
}

/* ======================================================
   RESPONSIVE
   ====================================================== */
@media (max-width: 992px) {
  .course-overview {
    grid-template-columns: 1fr;
  }
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>course_details_widget</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Course Details Widget</name>
        <option_schema/>
        <public>false</public>
        <roles>x_1862243_training.training user</roles>
        <script><![CDATA[(function () {

  data.course = {};

data.isTrainingUser = gs.hasRole('x_1862243_training.training user');
  data.isAdmin = gs.hasRole('x_1862243_training.training admin');
  data.isInstructor = gs.hasRole('x_1862243_training.training instructor');

  var courseGR = new GlideRecord('x_1862243_training_training_course_table');

  /* =========================
     REGISTER / WAITLIST
     ========================= */
  if (input && input.action === 'register') {

    var courseId = input.course_id;
    if (!courseId)
      return;

    if (!data.isTrainingUser)
      return;

    if (!courseGR.get(courseId))
      return;

    var availableSeats = courseGR.available_seats.nil()
      ? 0
      : parseInt(courseGR.available_seats, 10);

    // Prevent duplicate registration
    var regGR = new GlideRecord('x_1862243_training_training_registration_table');
    regGR.addQuery('course', courseId);
    regGR.addQuery('learner', gs.getUserID());
    regGR.query();

    if (regGR.next())
      return;

    var statusValue = (availableSeats > 0) ? 'registered' : 'waitlisted';

    var newReg = new GlideRecord('x_1862243_training_training_registration_table');
    newReg.initialize();
    newReg.course = courseId;
    newReg.learner = gs.getUserID();
    newReg.registration_status = statusValue;
    newReg.insert();

    if (statusValue === 'registered') {
      courseGR.available_seats = availableSeats - 1;
      courseGR.update();
    }

    return;
  }

  /* =========================
     PAGE LOAD
     ========================= */
  var pageCourseId = $sp.getParameter('course_id');
  if (!pageCourseId)
    return;

  if (!courseGR.get(pageCourseId))
    return;

  data.course = {
    sys_id: courseGR.getUniqueValue(),
    name: courseGR.getValue('course_name'),
    code: courseGR.getValue('course_code'), // âœ… course code included
    description: courseGR.getValue('course_description'),
    instructor: courseGR.getDisplayValue('instructor'),
    duration: courseGR.getValue('duration_hours'),
    category: courseGR.getValue('course_category'),
    maxSeats: parseInt(courseGR.maximum_seats, 10),
    availableSeats: courseGR.available_seats.nil()
      ? 0
      : parseInt(courseGR.available_seats, 10),
    startDate: courseGR.getValue('course_start_date'),
    endDate: courseGR.getValue('course_end_date'),
    location: courseGR.getValue('location'),
    isActive: courseGR.getValue('is_active')
  };
gs.info('Course Code value = ' + courseGR.getValue('course_code'));

})();
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-11 05:43:25</sys_created_on>
        <sys_id>804dacfa839e721084ade7d0deaad3ca</sys_id>
        <sys_mod_count>79</sys_mod_count>
        <sys_name>Course Details Widget</sys_name>
        <sys_package display_value="Training Registration and Certification Portal" source="x_1862243_training">cd4f29228352721084ade7d0deaad3c0</sys_package>
        <sys_policy/>
        <sys_scope display_value="Training Registration and Certification Portal">cd4f29228352721084ade7d0deaad3c0</sys_scope>
        <sys_update_name>sp_widget_804dacfa839e721084ade7d0deaad3ca</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-15 09:20:31</sys_updated_on>
        <template><![CDATA[<div class="course-container">

  <!-- COURSE HEADER -->
<!-- COURSE HEADER -->
<div class="course-header">

  <!-- Course Name -->
  <div class="course-title">
    {{data.course.name || 'Select a Course'}}
  </div>

  <!-- Meta Row -->
  <div class="course-meta-row">

    <!-- Course Code -->
<span class="course-code">
      Code: {{data.course.code}}
    </span>

    <!-- Active / Inactive -->
    <span class="course-status"
          ng-class="{
            'active': data.course.isActive == '1' || data.course.isActive == true,
            'inactive': data.course.isActive == '0'
          }">
      {{ (data.course.isActive == '1' || data.course.isActive == true) ? 'Active' : 'Inactive' }}
    </span>

  </div>

</div>


  <!-- COURSE OVERVIEW -->
  <div class="course-overview" ng-if="data.course.sys_id">

    <!-- LEFT INFO -->
    <div class="course-info">

      <!-- Description -->
<div class="course-description-block">
  <span class="desc-label">Description</span>
  <p class="course-description">
    {{data.course.description || 'No description available for this course.'}}
  </p>
</div>


      <!-- Info Grid -->
      <div class="info-grid">

        <div class="info-item">
          <span class="info-label">Instructor</span>
          <span class="info-value">{{data.course.instructor}}</span>
        </div>

        <div class="info-item">
          <span class="info-label">Category</span>
          <span class="info-chip">{{data.course.category}}</span>
        </div>

        <div class="info-item">
          <span class="info-label">Location</span>
          <span class="info-value">{{data.course.location}}</span>
        </div>

        <div class="info-item">
          <span class="info-label">Duration</span>
          <span class="info-value">{{data.course.duration}} hours</span>
        </div>

        <!-- Start Date -->
        <div class="info-item">
          <span class="info-label">Start Date</span>
          <span class="info-value">{{data.course.startDate}}</span>
        </div>

        <!-- End Date -->
        <div class="info-item">
          <span class="info-label">End Date</span>
          <span class="info-value">{{data.course.endDate}}</span>
        </div>

      </div>
    </div>

    <!-- RIGHT STATS -->
    <div class="course-stats">

      <div class="stat-card">
        <div class="stat-number">{{data.course.availableSeats}}</div>
        <div class="stat-label">Seats Available</div>
        <div class="stat-sub">of {{data.course.maxSeats}}</div>
      </div>

      <div class="stat-actions" ng-if="data.isTrainingUser">

        <button class="btn-primary"
                ng-click="goToRegistration()"
                ng-disabled="data.course.availableSeats <= 0">
          Register
        </button>

        <button class="btn-secondary"
                ng-show="data.course.availableSeats <= 0"
                ng-click="goToWaitlist()">
          Join Waitlist
        </button>

      </div>
    </div>

  </div>

  <!-- EMPTY STATE -->
  <div class="empty-state" ng-if="!data.course.sys_id">
    Select a course from the list to view details.
  </div>

</div>
]]></template>
    </sp_widget>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>804dacfa839e721084ade7d0deaad3ca</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-15 08:49:52</sys_created_on>
        <sys_id>9a4ef10c83e23a1084ade7d0deaad3e2</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-15 08:49:52</sys_updated_on>
        <table>sp_widget</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
